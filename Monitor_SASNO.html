<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Monitor S√≠smico SASNO</title>
<link href="https://unpkg.com/leaflet/dist/leaflet.css" rel="stylesheet"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
    }
    #mapaSismo {
      width: 100vw;
      height: 100vh;
    }
    #panel {
      position: absolute;
      bottom: 15px;
      left: 15px;
      background-color: black;
      color: white;
      width: 330px;
      font-family: sans-serif;
      font-size: 13px;
      border: 2px solid white;
      z-index: 9999;
    }
    .panel-section {
      border-bottom: 3px solid white;
      padding: 10px;
    }
    .title {
      font-size: 20px;
      font-weight: bold;
      text-align: center;
    }
    .subtitle {
      font-size: 14px;
      text-align: center;
      margin-top: 4px;
    }
    .barra-verde {
      background-color: #28a745;
      color: white;
      padding: 2px 10px;
      font-weight: bold;
      display: inline-block;
      margin: 0 5px;
    }
    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .footer .version {
      font-size: 22px;
      font-weight: bold;
    }
    .footer .dot {
      width: 20px;
      height: 20px;
      background-color: #28a745;
      border-radius: 50%;
      display: inline-block;
    }
    #menu-btnMenu {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 40px;
      height: 40px;
      background: black;
      color: white;
      font-size: 28px;
      text-align: center;
      cursor: pointer;
      border: 2px solid white;
      z-index: 10000;
      line-height: 34px;
    }
    #menu-options {
      position: absolute;
      top: 60px;
      right: 15px;
      background: white;
      color: black;
      font-family: sans-serif;
      border: 1px solid gray;
      z-index: 10000;
      display: none;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
    }
    #menu-options div {
      padding: 10px;
      cursor: pointer;
      border-bottom: 1px solid #ccc;
    }
    #menu-options div:hover {
      background-color: #eee;
    }
  </style>
</head>
<body><button id="activarNotificaciones">Activar Notificaciones</button>
<div id="mapaSismo"></div>
<!-- Panel SASNO con INTENSIDAD -->
<div id="panel">
<div class="panel-section">
<div class="title">SASNO</div>
<div class="subtitle">Sistema de Alerta S√≠smica de notificaci√≥n oportuna</div>
<div class="subtitle"><strong>Central CDMX</strong></div>
</div>
<div class="panel-section">
<strong>Intensidad:</strong>
<span class="barra-verde" style="background-color: orange;">FUERTE üü†</span>
</div>
<div class="panel-section">
<div style="text-align:center; font-size: 12px;">MONITOR VERSION CENTRAL</div>
<div class="footer">
<div class="version">VER. 1.0</div>
<div class="dot"></div>
</div>
</div>
</div>
<!-- Men√∫ de capasMapa -->
<div id="menu-btnMenu">‚ò∞</div>
<div id="menu-options">
<div onclick="cambiarMapa('esri')">Esri Satelital</div>
<div onclick="cambiarMapa('usgs')">USGS Imagery</div>
<div onclick="cambiarMapa('carto')">CartoDB Voyager</div>
</div>
<script>
    const capasMapa = {
      esri: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: '¬© Esri'
      }),
      usgs: L.tileLayer('https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryOnly/MapServer/tile/{z}/{y}/{x}', {
        maxZoom: 20,
        attribution: 'USGS'
      }),
      carto: L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; OpenStreetMap & CARTO',
        subdomains: 'abcd',
        maxZoom: 20
      })
    };

    const mapaSismo = L.mapaSismo('mapaSismo', { zoomControl: false }).setView([19.3, -99.2], 7);
    capasMapa.esri.addTo(mapaSismo);

    const centralesSismo = [
      { nombre: "Ciudad de M√©xico", coord: [19.4326, -99.1332] },
      { nombre: "Oaxaca", coord: [17.0732, -96.7266] },
      { nombre: "Acapulco", coord: [16.8531, -99.8237] },
      { nombre: "Chilpancingo", coord: [17.5506, -99.5058] },
      { nombre: "Morelia", coord: [19.7008, -101.186] },
      { nombre: "Puebla", coord: [19.0414, -98.2063] },
      { nombre: "Colima", coord: [19.2433, -103.725] }
    ];

    function dibujarCentrales() {
      centralesSismo.forEach(c => {
        L.circle(c.coord, {
          radius: 10000,
          color: '#002f6c',
          fillColor: '#002f6c',
          fillOpacity: 1,
          weight: 2
        }).addTo(mapaSismo);
      });
    }

    dibujarCentrales();

    function cambiarMapa(nombre) {
      mapaSismo.eachLayer(layer => mapaSismo.removeLayer(layer));
      capasMapa[nombre].addTo(mapaSismo);
      dibujarCentrales();
      document.getElementById("menu-options").style.display = "none";
    }

    const btnMenu = document.getElementById('menu-btnMenu');
    const opcionesMenu = document.getElementById('menu-options');
    btnMenu.onclick = () => opcionesMenu.style.display = opcionesMenu.style.display === 'block' ? 'none' : 'block';
    window.onclick = e => {
      if (!btnMenu.contains(e.target) && !opcionesMenu.contains(e.target)) {
        opcionesMenu.style.display = 'none';
      }
    };

    function reproducirSonido(url) {
      new Audio(url).play();
    }

    function crearOndaEpicentro(center, color, velocidad) {
      const circuloOnda = L.circle(center, {
        radius: 0,
        color,
        weight: 2,
        fillOpacity: 0,
        fillColor: 'transparent'
      }).addTo(mapaSismo);

      reproducirSonido("https://sasmex.net/mapa/audio/VikingsHorn2.wav");

      let tiempoTranscurrido = 0;
      const duracionOnda = 120000;
      const crecimientoOnda = setInterval(() => {
        tiempoTranscurrido += 100;
        const radioAnimado = (velocidad * tiempoTranscurrido) / 1000;
        circuloOnda.setRadius(radioAnimado * 1000);
        if (tiempoTranscurrido >= duracionOnda) {
          clearInterval(crecimientoOnda);
          mapaSismo.removeLayer(circuloOnda);
        }
      }, 100);
    }

    function animarCentral(center) {
      const duracionCentrales = 120000;
      const intervaloCentrales = 3000;
      let tiempo = 0;

      const loopCentral = setInterval(() => {
        if (tiempo >= duracionCentrales) {
          clearInterval(loopCentral);
          return;
        }

        const radiosCentrales = [15000, 30000, 45000, 60000];
        radiosCentrales.forEach((radio, i) => {
          setTimeout(() => {
            const ondaCentral = L.circle(center, {
              radius: radio,
              color: '#002f6c',
              weight: 1.5,
              fillOpacity: 0
            }).addTo(mapaSismo);
            setTimeout(() => mapaSismo.removeLayer(ondaCentral), 2500);
          }, i * 300);
        });

        tiempo += intervaloCentrales;
      }, intervaloCentrales);
    }

    function inicializarCirculosEpicentro(posicion) {
      const configCirculos = [
        { radio: 200000, relleno: false },
        { radio: 150000, relleno: false },
        { radio: 100000, relleno: false },
        { radio: 50000, relleno: true }
      ];
      const circulosEpicentro = [];

      configCirculos.forEach(item => {
        const circuloOnda = L.circle(posicion, {
          radius: item.radio,
          color: 'gray',
          weight: 1,
          fillColor: 'gray',
          fillOpacity: item.relleno ? 0.1 : 0
        }).addTo(mapaSismo);
        circulosEpicentro.push(circuloOnda);
      });

      setTimeout(() => {
        circulosEpicentro.forEach(c => mapaSismo.removeLayer(c));
      }, 300000);
    }

    function mostrarEvento(lat, lng) {
      const epicentroEvento = L.latLng(lat, lng);
      crearOndaEpicentro(epicentroEvento, '#e5be01', 5); // S
      crearOndaEpicentro(epicentroEvento, '#800080', 8); // P
      reproducirSonido("https://sasmex.net/mapa/audio/ecobeep.wav");

      inicializarCirculosEpicentro(epicentroEvento);
      centralesSismo.forEach(c => animarCentral(c.coord));
    }

    
  </script>
</body>
</html> {
  console.log("üîî Alerta recibida:", payload);
  const data = payload.data || {};
  const estado = data.estado || "ADVISORY";
  const lat = parseFloat(data.latitud || "0");
  const lng = parseFloat(data.longitud || "0");
  const tieneCoordenadas = !(isNaN(lat) || isNaN(lng) || (lat === 0 &amp;&amp; lng === 0));

  // Funciones visuales
  function reproducirSonido(nombre) {
    const audio = new Audio("https://sasmex.net/mapa/audio/" + nombre);
    audio.play();
  }

  function dibujarEpicentro() {
    L.circle([lat, lng], { radius: 10000, color: "red" }).addTo(mapaSismo);
  }

  function crearOnda(center, color, velocidad) {
    const circuloOnda = L.circle(center, {
      radius: 0,
      color,
      weight: 2,
      fillOpacity: 0
    }).addTo(mapaSismo);
    let tiempo = 0;
    const duracionOnda = 120000;
    const intervaloCentrales = setInterval(() =&gt; {
      tiempo += 100;
      const radioAnimado = (velocidad * tiempo) / 1000;
      circuloOnda.setRadius(radioAnimado * 1000);
      if (tiempo &gt;= duracionOnda) {
        clearInterval(intervaloCentrales);
        mapaSismo.removeLayer(circuloOnda);
      }
    }, 100);
  }

  function dibujarCirculosEpicentro() {
    const radiosCentrales = [200000, 150000, 100000, 50000];
    radiosCentrales.forEach((r, i) =&gt; {
      const c = L.circle([lat, lng], {
        radius: r,
        color: "gray",
        weight: 1,
        fillColor: "gray",
        fillOpacity: r === 50000 ? 0.1 : 0
      }).addTo(mapaSismo);
      setTimeout(() =&gt; mapaSismo.removeLayer(c), 300000);
    });
  }

  // Panel
  const el = document.getElementById("intensidad");
  if (estado === "WARNING") {
    el.innerText = "FUERTE üü†";
    el.style.backgroundColor = "orange";
    el.style.color = "white";
    reproducirSonido("ecobeep.wav");
    if (tieneCoordenadas) {
      dibujarEpicentro();
      crearOnda([lat, lng], "#e5be01", 5); // S
      crearOnda([lat, lng], "#800080", 8); // P
      dibujarCirculosEpicentro();
    }
    animarCentrales();
  } else if (estado === "ADVISORY") {
    el.innerText = "LIGERO üü°";
    el.style.backgroundColor = "yellow";
    el.style.color = "black";
    reproducirSonido("ecobeep.wav");
    dibujarEpicentro();
    crearOnda([lat, lng], "#e5be01", 5); // S
    crearOnda([lat, lng], "#800080", 8); // P
    dibujarCirculosEpicentro();
  }
});
DOCTYPE html&gt;
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Monitor S√≠smico SASNO</title>
<link href="https://unpkg.com/leaflet/dist/leaflet.css" rel="stylesheet"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
    }
    #mapaSismo {
      width: 100vw;
      height: 100vh;
    }
    #panel {
      position: absolute;
      bottom: 15px;
      left: 15px;
      background-color: black;
      color: white;
      width: 330px;
      font-family: sans-serif;
      font-size: 13px;
      border: 2px solid white;
      z-index: 9999;
    }
    .panel-section {
      border-bottom: 3px solid white;
      padding: 10px;
    }
    .title {
      font-size: 20px;
      font-weight: bold;
      text-align: center;
    }
    .subtitle {
      font-size: 14px;
      text-align: center;
      margin-top: 4px;
    }
    .barra-verde {
      background-color: #28a745;
      color: white;
      padding: 2px 10px;
      font-weight: bold;
      display: inline-block;
      margin: 0 5px;
    }
    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .footer .version {
      font-size: 22px;
      font-weight: bold;
    }
    .footer .dot {
      width: 20px;
      height: 20px;
      background-color: #28a745;
      border-radius: 50%;
      display: inline-block;
    }
    #menu-btnMenu {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 40px;
      height: 40px;
      background: black;
      color: white;
      font-size: 28px;
      text-align: center;
      cursor: pointer;
      border: 2px solid white;
      z-index: 10000;
      line-height: 34px;
    }
    #menu-options {
      position: absolute;
      top: 60px;
      right: 15px;
      background: white;
      color: black;
      font-family: sans-serif;
      border: 1px solid gray;
      z-index: 10000;
      display: none;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
    }
    #menu-options div {
      padding: 10px;
      cursor: pointer;
      border-bottom: 1px solid #ccc;
    }
    #menu-options div:hover {
      background-color: #eee;
    }
  </style>
</head>
<body>
<div id="mapaSismo"></div>
<!-- Panel SASNO con INTENSIDAD -->
<div id="panel">
<div class="panel-section">
<div class="title">SASNO</div>
<div class="subtitle">Sistema de Alerta S√≠smica de notificaci√≥n oportuna</div>
<div class="subtitle"><strong>Central CDMX</strong></div>
</div>
<div class="panel-section">
<strong>Intensidad:</strong>
<span class="barra-verde" style="background-color: orange;">FUERTE üü†</span>
</div>
<div class="panel-section">
<div style="text-align:center; font-size: 12px;">MONITOR VERSION CENTRAL</div>
<div class="footer">
<div class="version">VER. 1.0</div>
<div class="dot"></div>
</div>
</div>
</div>
<!-- Men√∫ de capasMapa -->
<div id="menu-btnMenu">‚ò∞</div>
<div id="menu-options">
<div onclick="cambiarMapa('esri')">Esri Satelital</div>
<div onclick="cambiarMapa('usgs')">USGS Imagery</div>
<div onclick="cambiarMapa('carto')">CartoDB Voyager</div>
</div>
<script>
    const capasMapa = {
      esri: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: '¬© Esri'
      }),
      usgs: L.tileLayer('https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryOnly/MapServer/tile/{z}/{y}/{x}', {
        maxZoom: 20,
        attribution: 'USGS'
      }),
      carto: L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; OpenStreetMap & CARTO',
        subdomains: 'abcd',
        maxZoom: 20
      })
    };

    const mapaSismo = L.mapaSismo('mapaSismo', { zoomControl: false }).setView([19.3, -99.2], 7);
    capasMapa.esri.addTo(mapaSismo);

    const centralesSismo = [
      { nombre: "Ciudad de M√©xico", coord: [19.4326, -99.1332] },
      { nombre: "Oaxaca", coord: [17.0732, -96.7266] },
      { nombre: "Acapulco", coord: [16.8531, -99.8237] },
      { nombre: "Chilpancingo", coord: [17.5506, -99.5058] },
      { nombre: "Morelia", coord: [19.7008, -101.186] },
      { nombre: "Puebla", coord: [19.0414, -98.2063] },
      { nombre: "Colima", coord: [19.2433, -103.725] }
    ];

    function dibujarCentrales() {
      centralesSismo.forEach(c => {
        L.circle(c.coord, {
          radius: 10000,
          color: '#002f6c',
          fillColor: '#002f6c',
          fillOpacity: 1,
          weight: 2
        }).addTo(mapaSismo);
      });
    }

    dibujarCentrales();

    function cambiarMapa(nombre) {
      mapaSismo.eachLayer(layer => mapaSismo.removeLayer(layer));
      capasMapa[nombre].addTo(mapaSismo);
      dibujarCentrales();
      document.getElementById("menu-options").style.display = "none";
    }

    const btnMenu = document.getElementById('menu-btnMenu');
    const opcionesMenu = document.getElementById('menu-options');
    btnMenu.onclick = () => opcionesMenu.style.display = opcionesMenu.style.display === 'block' ? 'none' : 'block';
    window.onclick = e => {
      if (!btnMenu.contains(e.target) && !opcionesMenu.contains(e.target)) {
        opcionesMenu.style.display = 'none';
      }
    };

    function reproducirSonido(url) {
      new Audio(url).play();
    }

    function crearOndaEpicentro(center, color, velocidad) {
      const circuloOnda = L.circle(center, {
        radius: 0,
        color,
        weight: 2,
        fillOpacity: 0,
        fillColor: 'transparent'
      }).addTo(mapaSismo);

      reproducirSonido("https://sasmex.net/mapa/audio/VikingsHorn2.wav");

      let tiempoTranscurrido = 0;
      const duracionOnda = 120000;
      const crecimientoOnda = setInterval(() => {
        tiempoTranscurrido += 100;
        const radioAnimado = (velocidad * tiempoTranscurrido) / 1000;
        circuloOnda.setRadius(radioAnimado * 1000);
        if (tiempoTranscurrido >= duracionOnda) {
          clearInterval(crecimientoOnda);
          mapaSismo.removeLayer(circuloOnda);
        }
      }, 100);
    }

    function animarCentral(center) {
      const duracionCentrales = 120000;
      const intervaloCentrales = 3000;
      let tiempo = 0;

      const loopCentral = setInterval(() => {
        if (tiempo >= duracionCentrales) {
          clearInterval(loopCentral);
          return;
        }

        const radiosCentrales = [15000, 30000, 45000, 60000];
        radiosCentrales.forEach((radio, i) => {
          setTimeout(() => {
            const ondaCentral = L.circle(center, {
              radius: radio,
              color: '#002f6c',
              weight: 1.5,
              fillOpacity: 0
            }).addTo(mapaSismo);
            setTimeout(() => mapaSismo.removeLayer(ondaCentral), 2500);
          }, i * 300);
        });

        tiempo += intervaloCentrales;
      }, intervaloCentrales);
    }

    function inicializarCirculosEpicentro(posicion) {
      const configCirculos = [
        { radio: 200000, relleno: false },
        { radio: 150000, relleno: false },
        { radio: 100000, relleno: false },
        { radio: 50000, relleno: true }
      ];
      const circulosEpicentro = [];

      configCirculos.forEach(item => {
        const circuloOnda = L.circle(posicion, {
          radius: item.radio,
          color: 'gray',
          weight: 1,
          fillColor: 'gray',
          fillOpacity: item.relleno ? 0.1 : 0
        }).addTo(mapaSismo);
        circulosEpicentro.push(circuloOnda);
      });

      setTimeout(() => {
        circulosEpicentro.forEach(c => mapaSismo.removeLayer(c));
      }, 300000);
    }

    function mostrarEvento(lat, lng) {
      const epicentroEvento = L.latLng(lat, lng);
      crearOndaEpicentro(epicentroEvento, '#e5be01', 5); // S
      crearOndaEpicentro(epicentroEvento, '#800080', 8); // P
      reproducirSonido("https://sasmex.net/mapa/audio/ecobeep.wav");

      inicializarCirculosEpicentro(epicentroEvento);
      centralesSismo.forEach(c => animarCentral(c.coord));
    }

    
  

document.getElementById("activarNotificaciones").onclick = () => {
  Notification.requestPermission().then(permission => {
    if (permission === "granted") {
      messaging.getToken({
        vapidKey: "BGUpy2aSSE3VOYNQusqStdW2yMvyLlElh4XovBDWTU7dIM578aYLxkCSRpBGFo-N1fYjOJzluOFxFdrQwAmhIUg"
      }).then(token => {
        console.log("‚úÖ Token FCM:", token);
        alert("Suscrito a EQW y LOWINTENSITYQUAKES.");
        // Puedes llamar a tu backend aqu√≠ si quieres registrar el token
      }).catch(err => {
        console.error("‚ùå Error al obtener token:", err);
        alert("Error al obtener token FCM.");
      });
    } else {
      alert("Permiso denegado.");
    }
  });
};
</script>
</body>
</html>
